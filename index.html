<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">èŒ¶è¨€è§€è‰² Â· å®¢æˆ¶æµå¤±é¢¨éšªè©•ä¼°å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f9f7f2; 
        }
        body.lang-en {
            font-family: 'Inter', sans-serif;
        }
        .fade-in { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .chart-container { 
            position: relative; 
            height: 250px; 
            width: 100%; 
        }
        [data-lang] {
            display: none;
        }
        [data-lang].active {
            display: inline-block;
        }
        .lang-btn {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            border: 1px solid #d1d5db;
            cursor: pointer;
            background-color: white;
        }
        .lang-btn.active {
            background-color: #047857;
            color: white;
            border-color: #047857;
        }
    </style>
</head>
<body class="text-gray-800" id="bodyElement">

    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="text-2xl">ğŸ§‹</span>
                <span class="font-bold text-xl text-green-900">
                    <span data-lang="zh" class="active">èŒ¶è¨€è§€è‰²</span>
                    <span data-lang="cn">èŒ¶è¨€è§‚è‰²</span>
                    <span data-lang="en">TeaInsight</span>
                </span>
                <span class="text-sm font-normal text-gray-500">| 
                    <span data-lang="zh" class="active">å®¢æˆ¶æµå¤±é¢¨éšªè©•ä¼°å™¨</span>
                    <span data-lang="cn">å®¢æˆ·æµå¤±é£é™©è¯„ä¼°å™¨</span>
                    <span data-lang="en">Customer Churn Risk Assessor</span>
                </span>
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="switchLanguage('zh')" class="lang-btn active" id="langZhBtn">ç¹é«”</button>
                <button onclick="switchLanguage('cn')" class="lang-btn" id="langCnBtn">ç°¡é«”</button>
                <button onclick="switchLanguage('en')" class="lang-btn" id="langEnBtn">English</button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å…§å®¹å€ -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        
        <!-- æ¨™é¡Œå€ -->
        <div class="bg-gradient-to-r from-green-800 to-green-700 rounded-2xl p-6 mb-8 text-white shadow-lg">
            <h1 class="text-2xl md:text-3xl font-bold mb-2">
                <span data-lang="zh" class="active">ğŸ§‹ èŒ¶è¨€è§€è‰² Â· å®¢æˆ¶æµå¤±é¢¨éšªè©•ä¼°å™¨</span>
                <span data-lang="cn">ğŸ§‹ èŒ¶è¨€è§‚è‰² Â· å®¢æˆ·æµå¤±é£é™©è¯„ä¼°å™¨</span>
                <span data-lang="en">ğŸ§‹ TeaInsight Â· Customer Churn Risk Assessor</span>
            </h1>
            <p class="text-green-100 mb-4">
                <span data-lang="zh" class="active">è¼¸å…¥é¡§å®¢æ¶ˆè²»æ•¸æ“šï¼Œç³»çµ±å°‡è‡ªå‹•åˆ†ç¾¤ä¸¦é¡¯ç¤ºæµå¤±é¢¨éšªç­‰ç´šï¼Œæä¾›å…·é«”ç¶“ç‡Ÿå»ºè­°ã€‚</span>
                <span data-lang="cn">è¾“å…¥é¡¾å®¢æ¶ˆè´¹æ•°æ®ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨åˆ†ç¾¤å¹¶æ˜¾ç¤ºæµå¤±é£é™©ç­‰çº§ï¼Œæä¾›å…·ä½“ç»è¥å»ºè®®ã€‚</span>
                <span data-lang="en">Enter customer data to identify segment, churn risk, and get actionable recommendations.</span>
            </p>
            <div class="inline-flex items-center bg-green-700/50 px-3 py-1 rounded-full text-xs backdrop-blur">
                <span class="mr-1">âš¡</span>
                <span data-lang="zh" class="active">åŸºæ–¼ K-Means åˆ†ç¾¤æ¨¡å‹ Â· å››å¤§é—œéµç‰¹å¾µ Â· K=4</span>
                <span data-lang="cn">åŸºäº K-Means åˆ†ç¾¤æ¨¡å‹ Â· å››å¤§å…³é”®ç‰¹å¾ Â· K=4</span>
                <span data-lang="en">K-Means Clustering Â· 4 Key Features Â· K=4</span>
            </div>
        </div>

        <!-- CSV æ‰¹é‡åˆ†æå€ - åŒä¸€è¡Œåˆ†é–‹æ’åˆ— -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h3 class="font-bold text-gray-700 mb-4 flex items-center">
                <span class="mr-2">ğŸ“¤</span>
                <span data-lang="zh" class="active">æ‰¹é‡åˆ†æ</span>
                <span data-lang="cn">æ‰¹é‡åˆ†æ</span>
                <span data-lang="en">Batch Analysis</span>
            </h3>
            <div class="flex flex-wrap gap-3 mb-4">
                <button onclick="downloadTemplate()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm flex items-center">
                    ğŸ“¥ 
                    <span class="ml-1" data-lang="zh" class="active">ä¸‹è¼‰æ¨¡æ¿</span>
                    <span class="ml-1" data-lang="cn">ä¸‹è½½æ¨¡æ¿</span>
                    <span class="ml-1" data-lang="en">Download Template</span>
                </button>
                <label class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm cursor-pointer flex items-center">
                    ğŸ“¤ 
                    <span class="ml-1" data-lang="zh" class="active">ä¸Šå‚³ CSV</span>
                    <span class="ml-1" data-lang="cn">ä¸Šä¼  CSV</span>
                    <span class="ml-1" data-lang="en">Upload CSV</span>
                    <input type="file" id="csvFile" accept=".csv" onchange="handleCSVUpload(event)" class="hidden">
                </label>
                <button onclick="runBatchAnalysis()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm flex items-center">
                    ğŸ” 
                    <span class="ml-1" data-lang="zh" class="active">é–‹å§‹åˆ†æ</span>
                    <span class="ml-1" data-lang="cn">å¼€å§‹åˆ†æ</span>
                    <span class="ml-1" data-lang="en">Start Analysis</span>
                </button>
            </div>
            <div id="csvPreview" class="hidden mb-4"></div>
            <div id="batchResults" class="hidden"></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- å·¦å´ï¼šè¼¸å…¥è¡¨å–® -->
            <div class="lg:col-span-4">
                <div class="bg-white rounded-xl shadow-md p-6 sticky top-24">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ“‹</span>
                        <span data-lang="zh" class="active">è«‹è¼¸å…¥é¡§å®¢è³‡æ–™</span>
                        <span data-lang="cn">è¯·è¾“å…¥é¡¾å®¢èµ„æ–™</span>
                        <span data-lang="en">Enter Customer Data</span>
                    </h2>
                    <form id="churnForm" class="space-y-4" onsubmit="return false;">
                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ğŸµ 
                                <span data-lang="zh" class="active">æœˆæ¶ˆè²»æ¬¡æ•¸</span>
                                <span data-lang="cn">æœˆæ¶ˆè´¹æ¬¡æ•°</span>
                                <span data-lang="en">Monthly Visits</span>
                                <span class="text-xs text-gray-400">(0-50)</span>
                            </label>
                            <input type="number" id="freq" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="8.42" min="0" max="50" step="0.01" value="8.42">
                            <p class="text-xs text-red-500 mt-1 hidden" id="freqError">
                                <span data-lang="zh">è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­— (0-50)</span>
                                <span data-lang="cn">è¯·è¾“å…¥æœ‰æ•ˆæ•°å­— (0-50)</span>
                                <span data-lang="en">Please enter a valid number (0-50)</span>
                            </p>
                        </div>
                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ğŸ’° 
                                <span data-lang="zh" class="active">å¹³å‡æ¶ˆè²»é‡‘é¡</span>
                                <span data-lang="cn">å¹³å‡æ¶ˆè´¹é‡‘é¢</span>
                                <span data-lang="en">Avg Spending</span>
                                <span class="text-xs text-gray-400">(0-500)</span>
                            </label>
                            <input type="number" id="amount" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="73.14" min="0" max="500" step="0.01" value="73.14">
                            <p class="text-xs text-red-500 mt-1 hidden" id="amountError">
                                <span data-lang="zh">è«‹è¼¸å…¥æœ‰æ•ˆé‡‘é¡ (0-500)</span>
                                <span data-lang="cn">è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢ (0-500)</span>
                                <span data-lang="en">Please enter a valid amount (0-500)</span>
                            </p>
                        </div>
                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ğŸ“† 
                                <span data-lang="zh" class="active">è·ä¸Šæ¬¡åˆ°åº—å¤©æ•¸</span>
                                <span data-lang="cn">è·ä¸Šæ¬¡åˆ°åº—å¤©æ•°</span>
                                <span data-lang="en">Days Since Last Visit</span>
                                <span class="text-xs text-gray-400">(0-365)</span>
                            </label>
                            <input type="number" id="days" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="70.52" min="0" max="365" step="0.01" value="70.52">
                            <p class="text-xs text-red-500 mt-1 hidden" id="daysError">
                                <span data-lang="zh">è«‹è¼¸å…¥æœ‰æ•ˆå¤©æ•¸ (0-365)</span>
                                <span data-lang="cn">è¯·è¾“å…¥æœ‰æ•ˆå¤©æ•° (0-365)</span>
                                <span data-lang="en">Please enter valid days (0-365)</span>
                            </p>
                        </div>
                        <div class="input-group">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                â­ 
                                <span data-lang="zh" class="active">é¡§å®¢æ»¿æ„åº¦</span>
                                <span data-lang="cn">é¡¾å®¢æ»¡æ„åº¦</span>
                                <span data-lang="en">Satisfaction</span>
                                <span class="text-xs text-gray-400">(1-5)</span>
                            </label>
                            <input type="number" id="satisfaction" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="4.23" min="1" max="5" step="0.01" value="4.23">
                            <p class="text-xs text-red-500 mt-1 hidden" id="satError">
                                <span data-lang="zh">è«‹è¼¸å…¥ 1-5 ä¹‹é–“çš„è©•åˆ†</span>
                                <span data-lang="cn">è¯·è¾“å…¥ 1-5 ä¹‹é—´çš„è¯„åˆ†</span>
                                <span data-lang="en">Please enter a rating between 1-5</span>
                            </p>
                        </div>
                        
                        <div class="flex space-x-2 pt-2">
                            <button type="button" onclick="fillExample()" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">
                                ğŸ”„ <span data-lang="zh" class="active">ä½¿ç”¨ç¯„ä¾‹</span><span data-lang="cn">ä½¿ç”¨èŒƒä¾‹</span><span data-lang="en">Example</span>
                            </button>
                            <button type="button" onclick="resetForm()" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">
                                â†©ï¸ <span data-lang="zh" class="active">é‡ç½®</span><span data-lang="cn">é‡ç½®</span><span data-lang="en">Reset</span>
                            </button>
                            <button type="button" onclick="evaluateCustomer()" class="flex-2 px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-800 transition text-sm font-medium shadow-md">
                                ğŸ” <span data-lang="zh" class="active">è©•ä¼°</span><span data-lang="cn">è¯„ä¼°</span><span data-lang="en">Assess</span>
                            </button>
                        </div>
                    </form>

                    <!-- å››ç¾¤é«”èªªæ˜ -->
                    <div class="mt-6 pt-6 border-t">
                        <h3 class="text-sm font-medium text-gray-600 mb-3">
                            <span data-lang="zh" class="active">ğŸ“Š K-Means å››ç¾¤é«”å®šç¾©</span>
                            <span data-lang="cn">ğŸ“Š K-Means å››ç¾¤ä½“å®šä¹‰</span>
                            <span data-lang="en">ğŸ“Š K-Means Cluster Definitions</span>
                        </h3>
                        <div class="space-y-2 text-xs">
                            <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-amber-500 mr-2"></span>
                                <span data-lang="zh" class="active">ç¾¤é«” 0ï¼šé«˜æ»¿æ„æ²‰ç¡å®¢ (31% æµå¤±)</span>
                                <span data-lang="cn">ç¾¤ä½“ 0ï¼šé«˜æ»¡æ„æ²‰ç¡å®¢ (31% æµå¤±)</span>
                                <span data-lang="en">Cluster 0: High-Sat Dormant (31% churn)</span>
                            </div>
                            <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
                                <span data-lang="zh" class="active">ç¾¤é«” 1ï¼šæ ¸å¿ƒåƒ¹å€¼å®¢ (19% æµå¤±)</span>
                                <span data-lang="cn">ç¾¤ä½“ 1ï¼šæ ¸å¿ƒä»·å€¼å®¢ (19% æµå¤±)</span>
                                <span data-lang="en">Cluster 1: Core Value Customers (19% churn)</span>
                            </div>
                            <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-green-500 mr-2"></span>
                                <span data-lang="zh" class="active">ç¾¤é«” 2ï¼šç©©å®šå®¢ (10% æµå¤±)</span>
                                <span data-lang="cn">ç¾¤ä½“ 2ï¼šç¨³å®šå®¢ (10% æµå¤±)</span>
                                <span data-lang="en">Cluster 2: Stable Customers (10% churn)</span>
                            </div>
                            <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-red-500 mr-2"></span>
                                <span data-lang="zh" class="active">ç¾¤é«” 3ï¼šé«˜é¢¨éšªæµå¤±å®¢ (36% æµå¤±)</span>
                                <span data-lang="cn">ç¾¤ä½“ 3ï¼šé«˜é£é™©æµå¤±å®¢ (36% æµå¤±)</span>
                                <span data-lang="en">Cluster 3: High-Risk Churn (36% churn)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šçµæœå±•ç¤º -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- è©•ä¼°çµæœå¡ç‰‡ -->
                <div id="resultSection" class="bg-white rounded-xl shadow-md p-6 fade-in">
                    <div class="flex justify-between items-center mb-4 border-b pb-4">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                            <span class="mr-2">ğŸ“Š</span>
                            <span data-lang="zh" class="active">è©•ä¼°çµæœ</span>
                            <span data-lang="cn">è¯„ä¼°ç»“æœ</span>
                            <span data-lang="en">Assessment Results</span>
                            <span class="ml-3 px-3 py-1 bg-green-100 text-green-800 text-xs rounded-full" id="clusterBadge">ç¾¤çµ„ 0</span>
                        </h2>
                        <span class="text-sm text-gray-400" id="timestamp">å‰›å‰›æ›´æ–°</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- å·¦å´ï¼šå®¢æˆ¶ç•«åƒ -->
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold text-gray-800" id="clusterName">é«˜æ»¿æ„æ²‰ç¡å®¢</h3>
                                <span class="px-3 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full" id="riskBadge">ğŸ“‰ æµå¤±æ¯”ä¾‹ 31%</span>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg text-sm">
                                <div class="flex justify-between py-1">
                                    <span data-lang="zh" class="active">ğŸ“Š æœˆæ¶ˆè²»</span>
                                    <span data-lang="cn">ğŸ“Š æœˆæ¶ˆè´¹</span>
                                    <span data-lang="en">ğŸ“Š Monthly Visits</span>
                                    <span class="font-bold"><span id="resFreq">8.64</span> <span data-lang="zh" class="active">æ¬¡</span><span data-lang="cn">æ¬¡</span><span data-lang="en">times</span></span>
                                </div>
                                <div class="flex justify-between py-1">
                                    <span data-lang="zh" class="active">ğŸ’° å¹³å‡æ¶ˆè²»</span>
                                    <span data-lang="cn">ğŸ’° å¹³å‡æ¶ˆè´¹</span>
                                    <span data-lang="en">ğŸ’° Avg Spending</span>
                                    <span class="font-bold">$<span id="resAmount">72.09</span></span>
                                </div>
                                <div class="flex justify-between py-1">
                                    <span data-lang="zh" class="active">ğŸ“† è·ä¸Šæ¬¡åˆ°åº—</span>
                                    <span data-lang="cn">ğŸ“† è·ä¸Šæ¬¡åˆ°åº—</span>
                                    <span data-lang="en">ğŸ“† Days Since Last</span>
                                    <span class="font-bold"><span id="resDays">72.36</span> <span data-lang="zh" class="active">å¤©</span><span data-lang="cn">å¤©</span><span data-lang="en">days</span></span>
                                </div>
                                <div class="flex justify-between py-1">
                                    <span data-lang="zh" class="active">â­ æ»¿æ„åº¦</span>
                                    <span data-lang="cn">â­ æ»¡æ„åº¦</span>
                                    <span data-lang="en">â­ Satisfaction</span>
                                    <span class="font-bold"><span id="resSat">4.18</span></span>
                                </div>
                            </div>
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 text-sm text-yellow-800">
                                ğŸ’¡ <span data-lang="zh" class="active" id="insightText">æ»¿æ„åº¦é«˜ä½†è¨±ä¹…æœªåˆ°ï¼Œå¯èƒ½è¢«å…¶ä»–å“ç‰Œæ¶èµ°ã€‚</span>
                                <span data-lang="cn" id="insightTextCn">æ»¡æ„åº¦é«˜ä½†è®¸ä¹…æœªåˆ°ï¼Œå¯èƒ½è¢«å…¶ä»–å“ç‰ŒæŠ¢èµ°ã€‚</span>
                                <span data-lang="en" id="insightTextEn">High satisfaction but long absence - may have switched to competitors.</span>
                            </div>
                        </div>

                        <!-- å³å´ï¼šé¢¨éšªå„€è¡¨ -->
                        <div class="flex flex-col items-center justify-center bg-gray-50 rounded-lg p-4">
                            <div class="relative w-40 h-40">
                                <canvas id="gaugeChart"></canvas>
                                <div class="absolute inset-0 flex items-center justify-center flex-col">
                                    <span class="text-3xl font-bold text-gray-800" id="gaugeValue">31%</span>
                                    <span class="text-xs text-gray-500">
                                        <span data-lang="zh" class="active">æµå¤±é¢¨éšª</span>
                                        <span data-lang="cn">æµå¤±é£é™©</span>
                                        <span data-lang="en">Churn Risk</span>
                                    </span>
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <p class="text-sm font-medium" id="riskLevel">ğŸ”´ é«˜æµå¤±é¢¨éšª</p>
                                <p class="text-xs text-gray-500">
                                    <span data-lang="zh" class="active">æ‰€å±¬ç¾¤é«”å¹³å‡æµå¤±ç‡</span>
                                    <span data-lang="cn">æ‰€å±ç¾¤ä½“å¹³å‡æµå¤±ç‡</span>
                                    <span data-lang="en">Cluster average churn rate</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- è¡Œå‹•å»ºè­° -->
                    <div class="mt-6 bg-green-50 rounded-xl p-5">
                        <h4 class="font-bold text-green-900 mb-3 flex items-center">
                            <span class="mr-2">ğŸ“Œ</span>
                            <span data-lang="zh" class="active">ç¶“ç‡Ÿè¡Œå‹•å»ºè­°</span>
                            <span data-lang="cn">ç»è¥è¡ŒåŠ¨å»ºè®®</span>
                            <span data-lang="en">Action Recommendations</span>
                        </h4>
                        <ul class="space-y-2 text-sm text-gray-700" id="actionList"></ul>
                        <div class="mt-4 bg-white px-4 py-2 rounded-lg shadow-sm flex justify-between items-center">
                            <span class="text-xs text-gray-500" id="goalText">ğŸ¯ ç›®æ¨™ï¼šæå‡åˆ°åº—é »ç‡ï¼Œè½‰ç‚ºã€Œç©©å®šå®¢ã€</span>
                            <button class="text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition">
                                <span data-lang="zh" class="active">ç™¼é€ä¿ƒéŠ·è¨Šæ¯</span>
                                <span data-lang="cn">å‘é€ä¿ƒé”€ä¿¡æ¯</span>
                                <span data-lang="en">Send Promotion</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- åœ–è¡¨å€åŸŸ -->
                <div id="chartsSection" class="grid grid-cols-1 md:grid-cols-2 gap-6 fade-in">
                    <div class="bg-white rounded-xl shadow-md p-5">
                        <h3 class="font-bold text-gray-700 mb-4 text-sm flex items-center">
                            <span class="mr-2">ğŸ“ˆ</span>
                            <span data-lang="zh" class="active">æ­·å²æ¶ˆè²»è¶¨å‹¢ï¼ˆæ¨¡æ“¬ï¼‰</span>
                            <span data-lang="cn">å†å²æ¶ˆè´¹è¶‹åŠ¿ï¼ˆæ¨¡æ‹Ÿï¼‰</span>
                            <span data-lang="en">Spending Trend (Simulated)</span>
                        </h3>
                        <div class="chart-container"><canvas id="trendChart"></canvas></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-5">
                        <h3 class="font-bold text-gray-700 mb-4 text-sm flex items-center">
                            <span class="mr-2">ğŸ“Š</span>
                            <span data-lang="zh" class="active">å››ç¶­åº¦è©•åˆ†</span>
                            <span data-lang="cn">å››ç»´åº¦è¯„åˆ†</span>
                            <span data-lang="en">4D Score</span>
                        </h3>
                        <div class="chart-container"><canvas id="radarChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- é è„š -->
    <footer class="bg-white border-t mt-12 py-8">
        <div class="max-w-6xl mx-auto px-4 text-center text-xs text-gray-400">
            <p><span data-lang="zh" class="active">ğŸ“Š åŸºæ–¼ Colab åˆ†æ Â· K-Means (K=4)</span><span data-lang="cn">ğŸ“Š åŸºäº Colab åˆ†æ Â· K-Means (K=4)</span><span data-lang="en">ğŸ“Š Based on Colab Analysis Â· K-Means (K=4)</span></p>
            <p class="mt-2">Â© 2026 <span data-lang="zh" class="active">èŒ¶è¨€è§€è‰² Analytics</span><span data-lang="cn">èŒ¶è¨€è§‚è‰² Analytics</span><span data-lang="en">TeaInsight Analytics</span></p>
        </div>
    </footer>

    <script>
        // ç¾¤é«”æ•¸æ“š - å·²æ›´æ–°ç‚ºä½ æœ€æ–°æ•¸æ“š
        const clusterCenters = {
            0: { 
                nameZh: "é«˜æ»¿æ„æ²‰ç¡å®¢", nameCn: "é«˜æ»¡æ„æ²‰ç¡å®¢", nameEn: "High-Satisfaction Dormant", 
                freq: 8.64, amount: 72.09, days: 72.36, sat: 4.18, 
                churn: 31, 
                color: "#f59e0b",
                insightZh: "æ»¿æ„åº¦é«˜ä½†è¨±ä¹…æœªåˆ°ï¼Œå¯èƒ½è¢«å…¶ä»–å“ç‰Œæ¶èµ°ã€‚", 
                insightCn: "æ»¡æ„åº¦é«˜ä½†è®¸ä¹…æœªåˆ°ï¼Œå¯èƒ½è¢«å…¶ä»–å“ç‰ŒæŠ¢èµ°ã€‚", 
                insightEn: "High satisfaction but long absence - may have switched to competitors.",
                actionsZh: ["ç™¼é€ã€Œä¹…æœªè¦‹é¢ã€å°ˆå±¬å„ªæƒ ï¼Œä¾‹å¦‚ç¬¬ 2 æ¯åŠåƒ¹", "æ¨è–¦å­£ç¯€æ–°å“ï¼Œåˆ©ç”¨é«˜æ»¿æ„åº¦å¸å¼•å›è³¼", "å¯è€ƒæ…®ç°¡è¨Šå•å€™ + è´ˆé€å°é…æ–™"],
                actionsCn: ["å‘é€ã€Œä¹…æœªè§é¢ã€ä¸“å±ä¼˜æƒ ï¼Œä¾‹å¦‚ç¬¬ 2 æ¯åŠä»·", "æ¨èå­£èŠ‚æ–°å“ï¼Œåˆ©ç”¨é«˜æ»¡æ„åº¦å¸å¼•å›è´­", "å¯è€ƒè™‘çŸ­ä¿¡é—®å€™ + èµ é€å°é…æ–™"],
                actionsEn: ["Send 'Long time no see' exclusive offer (2nd cup half price)", "Recommend seasonal new products", "Consider SMS greeting with small gift"],
                goalZh: "æå‡åˆ°åº—é »ç‡ï¼Œè½‰ç‚ºã€Œç©©å®šå®¢ã€", 
                goalCn: "æå‡åˆ°åº—é¢‘ç‡ï¼Œè½¬ä¸ºã€Œç¨³å®šå®¢ã€", 
                goalEn: "Increase visit frequency, convert to 'Stable Customer'"
            },
            1: { 
                nameZh: "æ ¸å¿ƒåƒ¹å€¼å®¢", nameCn: "æ ¸å¿ƒä»·å€¼å®¢", nameEn: "Core Value Customers", 
                freq: 12.28, amount: 93.44, days: 26.93, sat: 3.47, 
                churn: 19, 
                color: "#3b82f6",
                insightZh: "é«˜æ¶ˆè²»é«˜é »æ¬¡ï¼Œæ˜¯å“ç‰Œçš„æ ¸å¿ƒè³‡ç”¢ï¼Œéœ€é‡é»ç¶­è­·ã€‚", 
                insightCn: "é«˜æ¶ˆè´¹é«˜é¢‘æ¬¡ï¼Œæ˜¯å“ç‰Œçš„æ ¸å¿ƒèµ„äº§ï¼Œéœ€é‡ç‚¹ç»´æŠ¤ã€‚", 
                insightEn: "High spending and frequency - core brand assets.",
                actionsZh: ["æä¾›æ–°å“å„ªå…ˆè©¦å–æ¬Š", "é‚€è«‹åƒèˆ‡å“ç‰Œæ´»å‹•æˆ–ç”¢å“ç ”ç™¼", "è¨­å®šå°ˆå±¬å®¢æœï¼Œæå‡æœå‹™é«”é©—"],
                actionsCn: ["æä¾›æ–°å“ä¼˜å…ˆè¯•å–æƒ", "é‚€è¯·å‚ä¸å“ç‰Œæ´»åŠ¨æˆ–äº§å“ç ”å‘", "è®¾ç½®ä¸“å±å®¢æœï¼Œæå‡æœåŠ¡ä½“éªŒ"],
                actionsEn: ["Priority tasting of new products", "Invite to brand events", "Dedicated customer service"],
                goalZh: "æå‡æ»¿æ„åº¦ï¼Œé˜²æ­¢è¢«ç«¶çˆ­å°æ‰‹æŒ–è§’", 
                goalCn: "æå‡æ»¡æ„åº¦ï¼Œé˜²æ­¢è¢«ç«äº‰å¯¹æ‰‹æŒ–è§’", 
                goalEn: "Improve satisfaction, prevent competitor poaching"
            },
            2: { 
                nameZh: "ç©©å®šå®¢", nameCn: "ç¨³å®šå®¢", nameEn: "Stable Customers", 
                freq: 6.82, amount: 59.70, days: 24.34, sat: 4.21, 
                churn: 10, 
                color: "#10b981",
                insightZh: "å¿ èª åº¦é«˜ã€æµå¤±é¢¨éšªå°ï¼Œæ˜¯é–€åº—çš„ç©©å®šåŸºç¤å®¢ç¾¤ã€‚", 
                insightCn: "å¿ è¯šåº¦é«˜ã€æµå¤±é£é™©å°ï¼Œæ˜¯é—¨åº—çš„ç¨³å®šåŸºç¡€å®¢ç¾¤ã€‚", 
                insightEn: "High loyalty, low churn risk - stable customer base.",
                actionsZh: ["é‚€è«‹å‡ç´š VIP æœƒå“¡ï¼Œäº«å—å°ˆå±¬æŠ˜æ‰£", "æä¾›ç”Ÿæ—¥ç¦®é‡èˆ‡ç¯€æ—¥å•å€™", "é¼“å‹µåˆ†äº«é«”é©—ï¼Œæ“´å¤§å£ç¢‘å‚³æ’­"],
                actionsCn: ["é‚€è¯·å‡çº§ VIP ä¼šå‘˜ï¼Œäº«å—ä¸“å±æŠ˜æ‰£", "æä¾›ç”Ÿæ—¥ç¤¼é‡ä¸èŠ‚æ—¥é—®å€™", "é¼“åŠ±åˆ†äº«ä½“éªŒï¼Œæ‰©å¤§å£ç¢‘ä¼ æ’­"],
                actionsEn: ["Invite to upgrade VIP membership", "Provide birthday treats and holiday greetings", "Encourage sharing experiences"],
                goalZh: "ç¶­æŒé—œä¿‚ï¼Œæå‡å®¢å–®åƒ¹", 
                goalCn: "ç»´æŒå…³ç³»ï¼Œæå‡å®¢å•ä»·", 
                goalEn: "Maintain relationship, increase order value"
            },
            3: { 
                nameZh: "é«˜é¢¨éšªæµå¤±å®¢", nameCn: "é«˜é£é™©æµå¤±å®¢", nameEn: "High-Risk Churn", 
                freq: 6.45, amount: 80.16, days: 56.62, sat: 2.35, 
                churn: 36, 
                color: "#ef4444",
                insightZh: "æ»¿æ„åº¦ä½ä¸”ä¹…æœªæ¶ˆè²»ï¼Œæµå¤±é¢¨éšªæœ€é«˜ï¼Œéœ€ç·Šæ€¥ä»‹å…¥æŒ½å›ã€‚", 
                insightCn: "æ»¡æ„åº¦ä½ä¸”ä¹…æœªæ¶ˆè´¹ï¼Œæµå¤±é£é™©æœ€é«˜ï¼Œéœ€ç´§æ€¥ä»‹å…¥æŒ½å›ã€‚", 
                insightEn: "Low satisfaction, long absence - urgent intervention needed.",
                actionsZh: ["ä¸»å‹•å›è¨ªäº†è§£ä¸æ»¿æ„åŸå› ", "æä¾›çœŸèª è£œå„Ÿé«”é©—ï¼ˆå…è²»å‡ç´š/è´ˆå“ï¼‰", "æ”¹å–„æœå‹™æµç¨‹å¾Œé‚€è«‹å†æ¬¡é«”é©—"],
                actionsCn: ["ä¸»åŠ¨å›è®¿äº†è§£ä¸æ»¡æ„åŸå› ", "æä¾›çœŸè¯šè¡¥å¿ä½“éªŒï¼ˆå…è´¹å‡çº§/èµ å“ï¼‰", "æ”¹å–„æœåŠ¡æµç¨‹åé‚€è¯·å†æ¬¡ä½“éªŒ"],
                actionsEn: ["Proactively follow up on dissatisfaction", "Provide sincere compensation (free upgrade/gift)", "Improve service, invite to try again"],
                goalZh: "ç·Šæ€¥æŒ½å›ï¼Œè§£æ±ºæœå‹™å•é¡Œ", 
                goalCn: "ç´§æ€¥æŒ½å›ï¼Œè§£å†³æœåŠ¡é—®é¢˜", 
                goalEn: "Urgent recovery, resolve service issues"
            }
        };

        let gaugeChart, trendChart, radarChart, lastResult, currentLang = 'zh', csvData = [];

        // èªè¨€åˆ‡æ›
        function switchLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-lang]').forEach(el => {
                if (el.getAttribute('data-lang') === lang) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
            
            document.getElementById('bodyElement').className = 'text-gray-800';
            if (lang === 'en') {
                document.getElementById('bodyElement').classList.add('lang-en');
            }
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-green-700', 'text-white', 'border-green-700');
                btn.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
            });
            
            if (lang === 'zh') {
                document.getElementById('langZhBtn').classList.add('active', 'bg-green-700', 'text-white', 'border-green-700');
                document.getElementById('pageTitle').innerText = 'èŒ¶è¨€è§€è‰² Â· å®¢æˆ¶æµå¤±é¢¨éšªè©•ä¼°å™¨';
            } else if (lang === 'cn') {
                document.getElementById('langCnBtn').classList.add('active', 'bg-green-700', 'text-white', 'border-green-700');
                document.getElementById('pageTitle').innerText = 'èŒ¶è¨€è§‚è‰² Â· å®¢æˆ·æµå¤±é£é™©è¯„ä¼°å™¨';
            } else {
                document.getElementById('langEnBtn').classList.add('active', 'bg-green-700', 'text-white', 'border-green-700');
                document.getElementById('pageTitle').innerText = 'TeaInsight Â· Customer Churn Risk Assessor';
            }
            
            // æ›´æ–° CSV é è¦½æ–‡å­—
            const csvStats = document.getElementById('csvStats');
            if (csvStats && csvData.length > 0) {
                csvStats.innerText = lang === 'zh' ? `å…± ${csvData.length} ç­†æ•¸æ“šï¼ˆåƒ…é¡¯ç¤ºå‰ 5 ç­†ï¼‰` : 
                                    lang === 'cn' ? `å…± ${csvData.length} ç¬”æ•°æ®ï¼ˆä»…æ˜¾ç¤ºå‰ 5 ç¬”ï¼‰` : 
                                    `Total ${csvData.length} records (showing first 5)`;
            }
            
            // æ›´æ–°åˆ†æçµæœæ–‡å­—
            const batchStats = document.getElementById('batchStats');
            if (batchStats) {
                const total = batchStats.getAttribute('data-total') || '0';
                batchStats.innerText = lang === 'zh' ? `å…± ${total} ç­†çµæœï¼ˆåƒ…é¡¯ç¤ºå‰ 5 ç­†ï¼‰` : 
                                      lang === 'cn' ? `å…± ${total} ç¬”ç»“æœï¼ˆä»…æ˜¾ç¤ºå‰ 5 ç¬”ï¼‰` : 
                                      `Total ${total} results (showing first 5)`;
            }
            
            if (lastResult) {
                updateUIText(lastResult);
            }
        }

        // é‡ç½®è¡¨å–®
        function resetForm() {
            document.getElementById('freq').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('days').value = '';
            document.getElementById('satisfaction').value = '';
            ['freqError','amountError','daysError','satError'].forEach(id => 
                document.getElementById(id).classList.add('hidden'));
        }

        // ä½¿ç”¨ç¯„ä¾‹ - æ›´æ–°ç‚ºç¾¤é«”1ï¼ˆæ ¸å¿ƒåƒ¹å€¼å®¢ï¼‰å˜…æ•¸æ“š
        function fillExample() {
            document.getElementById('freq').value = 12.28;
            document.getElementById('amount').value = 93.44;
            document.getElementById('days').value = 26.93;
            document.getElementById('satisfaction').value = 3.47;
            evaluateCustomer();
        }

        // è¨ˆç®—è·é›¢
        function calculateDistance(input, center) {
            const scale = { freq: 15, amount: 50, days: 90, sat: 2 };
            return Math.sqrt(
                Math.pow((input.freq - center.freq) / scale.freq, 2) +
                Math.pow((input.amount - center.amount) / scale.amount, 2) +
                Math.pow((input.days - center.days) / scale.days, 2) +
                Math.pow((input.sat - center.sat) / scale.sat, 2)
            );
        }

        // åˆ†é¡é¡§å®¢
        function classifyCustomer(freq, amount, days, sat) {
            const input = {freq, amount, days, sat};
            let minDist = Infinity, bestCluster = '0';
            for (let id in clusterCenters) {
                let dist = calculateDistance(input, clusterCenters[id]);
                if (dist < minDist) { 
                    minDist = dist; 
                    bestCluster = id; 
                }
            }
            return { clusterId: parseInt(bestCluster), ...clusterCenters[bestCluster] };
        }

        // è©•ä¼°é¡§å®¢
        function evaluateCustomer() {
            let freq = parseFloat(document.getElementById('freq').value);
            let amount = parseFloat(document.getElementById('amount').value);
            let days = parseFloat(document.getElementById('days').value);
            let sat = parseFloat(document.getElementById('satisfaction').value);
            
            let isValid = true;
            
            if (isNaN(freq) || freq < 0 || freq > 50) { 
                document.getElementById('freqError').classList.remove('hidden'); 
                isValid = false; 
            } else { 
                document.getElementById('freqError').classList.add('hidden'); 
            }
            
            if (isNaN(amount) || amount < 0 || amount > 500) { 
                document.getElementById('amountError').classList.remove('hidden'); 
                isValid = false; 
            } else { 
                document.getElementById('amountError').classList.add('hidden'); 
            }
            
            if (isNaN(days) || days < 0 || days > 365) { 
                document.getElementById('daysError').classList.remove('hidden'); 
                isValid = false; 
            } else { 
                document.getElementById('daysError').classList.add('hidden'); 
            }
            
            if (isNaN(sat) || sat < 1 || sat > 5) { 
                document.getElementById('satError').classList.remove('hidden'); 
                isValid = false; 
            } else { 
                document.getElementById('satError').classList.add('hidden'); 
            }
            
            if (!isValid) return;

            let result = classifyCustomer(freq, amount, days, sat);
            lastResult = result;
            updateResultUI(result, {freq, amount, days, sat});
            renderGauge(result.churn, result.color);
            renderTrendChart(freq, days);
            renderRadarChart(freq, amount, days, sat);
        }

        // æ›´æ–°çµæœ UI
        function updateResultUI(result, input) {
            let name, insight, actions, goal;
            if (currentLang === 'en') { 
                name = result.nameEn; 
                insight = result.insightEn; 
                actions = result.actionsEn; 
                goal = result.goalEn; 
            } else if (currentLang === 'cn') { 
                name = result.nameCn; 
                insight = result.insightCn; 
                actions = result.actionsCn; 
                goal = result.goalCn; 
            } else { 
                name = result.nameZh; 
                insight = result.insightZh; 
                actions = result.actionsZh; 
                goal = result.goalZh; 
            }

            document.getElementById('clusterBadge').innerHTML = (currentLang==='zh'?'ç¾¤çµ„ ':currentLang==='cn'?'ç¾¤ä½“ ':'Cluster ')+result.clusterId;
            document.getElementById('clusterName').innerText = name;
            document.getElementById('riskBadge').innerHTML = `ğŸ“‰ ${currentLang==='zh'?'æµå¤±æ¯”ä¾‹':currentLang==='cn'?'æµå¤±æ¯”ä¾‹':'Churn Rate'} ${result.churn}%`;
            
            if (currentLang === 'en') {
                document.getElementById('insightText').classList.remove('active');
                document.getElementById('insightTextCn').classList.remove('active');
                document.getElementById('insightTextEn').classList.add('active');
                document.getElementById('insightTextEn').innerText = insight;
            } else if (currentLang === 'cn') {
                document.getElementById('insightText').classList.remove('active');
                document.getElementById('insightTextEn').classList.remove('active');
                document.getElementById('insightTextCn').classList.add('active');
                document.getElementById('insightTextCn').innerText = insight;
            } else {
                document.getElementById('insightText').classList.add('active');
                document.getElementById('insightTextEn').classList.remove('active');
                document.getElementById('insightTextCn').classList.remove('active');
                document.getElementById('insightText').innerText = insight;
            }

            document.getElementById('resFreq').innerText = input.freq.toFixed(2);
            document.getElementById('resAmount').innerText = input.amount.toFixed(2);
            document.getElementById('resDays').innerText = input.days.toFixed(2);
            document.getElementById('resSat').innerText = input.sat.toFixed(2);
            document.getElementById('goalText').innerHTML = `ğŸ¯ ${currentLang==='zh'?'ç›®æ¨™ï¼š':currentLang==='cn'?'ç›®æ ‡ï¼š':'Goal: '}${goal}`;
            
            let actionList = document.getElementById('actionList');
            actionList.innerHTML = '';
            actions.forEach((a, i) => {
                let li = document.createElement('li');
                li.className = "flex items-start";
                li.innerHTML = `<span class="mr-2 text-green-600 font-bold">${i+1}.</span> ${a}`;
                actionList.appendChild(li);
            });

            // æ™‚é–“æˆ³è·Ÿèªè¨€è½‰æ›
            document.getElementById('timestamp').innerText = new Date().toLocaleTimeString(
                currentLang === 'zh' ? 'zh-TW' : 
                currentLang === 'cn' ? 'zh-CN' : 
                'en-US', 
                {hour: '2-digit', minute:'2-digit'}
            );

            let riskLevel = document.getElementById('riskLevel');
            if (result.churn >= 30) {
                riskLevel.innerText = currentLang==='zh'?'ğŸ”´ é«˜æµå¤±é¢¨éšª':
                                      currentLang==='cn'?'ğŸ”´ é«˜æµå¤±é£é™©':
                                      'ğŸ”´ High Churn Risk';
            } else if (result.churn >= 20) {
                riskLevel.innerText = currentLang==='zh'?'ğŸŸ  ä¸­é«˜æµå¤±é¢¨éšª':
                                      currentLang==='cn'?'ğŸŸ  ä¸­é«˜æµå¤±é£é™©':
                                      'ğŸŸ  Medium-High Churn Risk';
            } else if (result.churn >= 10) {
                riskLevel.innerText = currentLang==='zh'?'ğŸŸ¡ ä¸­æµå¤±é¢¨éšª':
                                      currentLang==='cn'?'ğŸŸ¡ ä¸­æµå¤±é£é™©':
                                      'ğŸŸ¡ Medium Churn Risk';
            } else {
                riskLevel.innerText = currentLang==='zh'?'ğŸŸ¢ ä½æµå¤±é¢¨éšª':
                                      currentLang==='cn'?'ğŸŸ¢ ä½æµå¤±é£é™©':
                                      'ğŸŸ¢ Low Churn Risk';
            }
        }

        function updateUIText(result) {
            let name, insight, actions, goal;
            if (currentLang === 'en') { 
                name = result.nameEn; 
                insight = result.insightEn; 
                actions = result.actionsEn; 
                goal = result.goalEn; 
            } else if (currentLang === 'cn') { 
                name = result.nameCn; 
                insight = result.insightCn; 
                actions = result.actionsCn; 
                goal = result.goalCn; 
            } else { 
                name = result.nameZh; 
                insight = result.insightZh; 
                actions = result.actionsZh; 
                goal = result.goalZh; 
            }

            document.getElementById('clusterBadge').innerHTML = (currentLang==='zh'?'ç¾¤çµ„ ':currentLang==='cn'?'ç¾¤ä½“ ':'Cluster ')+result.clusterId;
            document.getElementById('clusterName').innerText = name;
            
            if (currentLang === 'en') {
                document.getElementById('insightText').classList.remove('active');
                document.getElementById('insightTextCn').classList.remove('active');
                document.getElementById('insightTextEn').classList.add('active');
                document.getElementById('insightTextEn').innerText = insight;
            } else if (currentLang === 'cn') {
                document.getElementById('insightText').classList.remove('active');
                document.getElementById('insightTextEn').classList.remove('active');
                document.getElementById('insightTextCn').classList.add('active');
                document.getElementById('insightTextCn').innerText = insight;
            } else {
                document.getElementById('insightText').classList.add('active');
                document.getElementById('insightTextEn').classList.remove('active');
                document.getElementById('insightTextCn').classList.remove('active');
                document.getElementById('insightText').innerText = insight;
            }
            
            document.getElementById('goalText').innerHTML = `ğŸ¯ ${currentLang==='zh'?'ç›®æ¨™ï¼š':currentLang==='cn'?'ç›®æ ‡ï¼š':'Goal: '}${goal}`;
            
            let actionList = document.getElementById('actionList');
            actionList.innerHTML = '';
            actions.forEach((a, i) => {
                let li = document.createElement('li');
                li.className = "flex items-start";
                li.innerHTML = `<span class="mr-2 text-green-600 font-bold">${i+1}.</span> ${a}`;
                actionList.appendChild(li);
            });
        }

        // åœ–è¡¨æ¸²æŸ“
        function renderGauge(percent, color) {
            if (gaugeChart) gaugeChart.destroy();
            let ctx = document.getElementById('gaugeChart').getContext('2d');
            gaugeChart = new Chart(ctx, {
                type: 'doughnut',
                data: { 
                    labels: ['Risk','Safe'], 
                    datasets: [{ 
                        data: [percent, 100-percent], 
                        backgroundColor: [color, '#e5e7eb'], 
                        borderWidth: 0, 
                        circumference: 180, 
                        rotation: 270 
                    }] 
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } }, 
                    cutout: '70%' 
                }
            });
            document.getElementById('gaugeValue').innerText = percent+'%';
        }

        function renderTrendChart(freq, days) {
            if (trendChart) trendChart.destroy();
            let months = currentLang==='en'?['Jan','Feb','Mar','Apr','May','Jun']:['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ'];
            let base = freq * 73;
            let data = [];
            for (let i=0; i<6; i++) {
                let decline = days>60 ? i*0.3 : days>30 ? i*0.15 : 0;
                data.push(Math.max(0, base*(1-decline)*(0.8+Math.random()*0.4)));
            }
            let ctx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(ctx, {
                type: 'line',
                data: { 
                    labels: months, 
                    datasets: [{ 
                        label: currentLang==='zh'?'æ¶ˆè²»é‡‘é¡':currentLang==='cn'?'æ¶ˆè´¹é‡‘é¢':'Spending', 
                        data: data, 
                        borderColor: '#047857', 
                        backgroundColor: 'rgba(4,120,87,0.1)', 
                        fill: true, 
                        tension: 0.4 
                    }] 
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } } 
                }
            });
        }

        function renderRadarChart(freq, amount, days, sat) {
            if (radarChart) radarChart.destroy();
            let normFreq = Math.min(100, (freq/15)*100);
            let normAmount = Math.min(100, (amount/100)*100);
            let normDays = Math.max(0, 100 - (days/90)*100);
            let normSat = (sat/5)*100;
            
            let labels, customerLabel, avgLabel;
            if (currentLang === 'en') {
                labels = ['Visit Freq', 'Spending', 'Recency', 'Satisfaction'];
                customerLabel = 'This Customer';
                avgLabel = 'Average';
            } else if (currentLang === 'cn') {
                labels = ['æ¶ˆè´¹é¢‘ç‡', 'æ¶ˆè´¹é‡‘é¢', 'è¿‘æœŸæ´»è·ƒ', 'æ»¡æ„åº¦'];
                customerLabel = 'æ­¤é¡¾å®¢';
                avgLabel = 'å¹³å‡æ°´å¹³';
            } else {
                labels = ['æ¶ˆè²»é »ç‡', 'æ¶ˆè²»é‡‘é¡', 'è¿‘æœŸæ´»èº', 'æ»¿æ„åº¦'];
                customerLabel = 'æ­¤é¡§å®¢';
                avgLabel = 'å¹³å‡æ°´æº–';
            }
            
            let ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        { 
                            label: customerLabel, 
                            data: [normFreq, normAmount, normDays, normSat], 
                            backgroundColor: 'rgba(4,120,87,0.2)', 
                            borderColor: '#047857', 
                            pointBackgroundColor: '#047857' 
                        },
                        { 
                            label: avgLabel, 
                            data: [50,50,50,50], 
                            backgroundColor: 'rgba(156,163,175,0.1)', 
                            borderColor: '#9ca3af', 
                            borderDash: [5,5] 
                        }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { r: { min:0, max:100 } } 
                }
            });
        }

        // CSV åŠŸèƒ½
        function downloadTemplate() {
            let template = "customer_id,monthly_visits,avg_spending,days_since_last_visit,satisfaction\nC001,8.64,72.09,72.36,4.18\nC002,12.28,93.44,26.93,3.47\nC003,6.82,59.70,24.34,4.21\nC004,6.45,80.16,56.62,2.35";
            let blob = new Blob([template], {type: 'text/csv'});
            let a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = currentLang==='zh'?'é¡§å®¢æ¨¡æ¿.csv':currentLang==='cn'?'é¡¾å®¢æ¨¡æ¿.csv':'customer_template.csv';
            a.click();
        }

        function handleCSVUpload(e) {
            let file = e.target.files[0];
            if (!file) return;
            Papa.parse(file, { 
                header: true, 
                complete: (res) => { 
                    csvData = res.data; 
                    displayCSVPreview(csvData);
                } 
            });
        }

        function displayCSVPreview(data) {
            const previewDiv = document.getElementById('csvPreview');
            if (!previewDiv) return;
            
            const previewData = data.slice(0, 5);
            const headers = Object.keys(previewData[0]);
            
            let html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full text-xs">
                        <thead class="bg-gray-100">
                            <tr>
                                ${headers.map(h => `<th class="px-2 py-1 text-left">${h}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${previewData.map(row => `
                                <tr class="border-b">
                                    ${headers.map(h => `<td class="px-2 py-1">${row[h] || '-'}</td>`).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <p class="text-xs text-gray-500 mt-2" id="csvStats">
                        ${currentLang === 'zh' ? `å…± ${data.length} ç­†æ•¸æ“šï¼ˆåƒ…é¡¯ç¤ºå‰ 5 ç­†ï¼‰` : 
                          currentLang === 'cn' ? `å…± ${data.length} ç¬”æ•°æ®ï¼ˆä»…æ˜¾ç¤ºå‰ 5 ç¬”ï¼‰` : 
                          `Total ${data.length} records (showing first 5)`}
                    </p>
                </div>
            `;
            
            previewDiv.innerHTML = html;
            previewDiv.classList.remove('hidden');
        }

        function runBatchAnalysis() {
            if (!csvData.length) { 
                alert(currentLang==='zh'?'è«‹å…ˆä¸Šå‚³ CSV':currentLang==='cn'?'è¯·å…ˆä¸Šä¼  CSV':'Please upload CSV'); 
                return; 
            }
            let results = csvData.map(row => {
                let r = classifyCustomer(
                    parseFloat(row.monthly_visits)||0, 
                    parseFloat(row.avg_spending)||0, 
                    parseFloat(row.days_since_last_visit)||0, 
                    parseFloat(row.satisfaction)||0
                );
                return { 
                    id: row.customer_id||'?', 
                    cluster: currentLang==='zh'?r.nameZh:currentLang==='cn'?r.nameCn:r.nameEn, 
                    churn: r.churn 
                };
            });
            let html = '<div class="mt-4 p-4 bg-gray-50 rounded"><h4 class="font-bold mb-2">ğŸ“Š åˆ†æçµæœ</h4>';
            results.slice(0,5).forEach(r => html += `<div class="text-xs py-1">${r.id} â†’ ${r.cluster} (${r.churn}%)</div>`);
            if (results.length>5) {
                html += `<div class="text-xs text-gray-500 mt-1" id="batchStats" data-total="${results.length}">${
                    currentLang==='zh'?`å…± ${results.length} ç­†çµæœï¼ˆåƒ…é¡¯ç¤ºå‰ 5 ç­†ï¼‰`:
                    currentLang==='cn'?`å…± ${results.length} ç¬”ç»“æœï¼ˆä»…æ˜¾ç¤ºå‰ 5 ç¬”ï¼‰`:
                    `Total ${results.length} results (showing first 5)`
                }</div>`;
            }
            html += '</div>';
            document.getElementById('batchResults').innerHTML = html;
            document.getElementById('batchResults').classList.remove('hidden');
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            switchLanguage('zh');
            evaluateCustomer();
        };
    </script>
</body>
</html>
